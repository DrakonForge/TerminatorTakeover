{
    "Class": "Instruction",
    "DefaultState": ".Default",
    "Parameters": {
        "_ImportStates": [
            "Idle",
            "Alerted",
            "Chase",
            "Search",
            "Spar",
            "Neutral",
            "Friendly",
            "Revered",
            "Warn"
        ],
        "MotionComponent": {
            "Value": "Component_Trork_Instruction_Idle_Motion_Wander",
            "Description": "The component that controls how the NPC moves during idle state"
        },
        "ViewRange": {
            "Value": 15,
            "Description": "View range"
        },
        "ViewSector": {
            "Value": 180,
            "Description": "View sector"
        },
        "HearingRange": {
            "Value": 8,
            "Description": "Hearing range"
        },
        "AlertedRange": {
            "Value": 30,
            "Description": "A range within which the player can be seen/sensed when the NPC is alerted to their presence"
        },
        "PrimaryIdleTimeout": {
            "Value": [
                15,
                20
            ],
            "Description": "The time range for which a primary idle should be executed before attempting to pick again"
        },
        "StayAtPost": {
            "Value": false,
            "Description": "Whether this NPC will stay at its post rather than going to do other things on occasion"
        },
        "ExtraIdleComponent": {
            "Value": "",
            "Description": "A reference to an extra component containing further idle behaviours"
        },
        "ExtraIdleWeight": {
            "Value": 15,
            "Description": "Weight for executing extra idle"
        },
        "ExcludeGroups": {
            "Value": [
                "Trork_Underlings"
            ],
            "Description": "A list of groups to exclude from reputation sensors"
        },
        "RangedAttack": {
            "Value": "",
            "Description": "Ranged attack"
        },
        "BedBlockSet": {
            "Value": "Trork_Bedroll",
            "Description": "The block set designating bedrolls for this NPC"
        },
        "CampfireBlockSet": {
            "Value": "Trork_Campfire",
            "Description": "The block set designating campfires for this NPC"
        },
        "ChestBlockSet": {
            "Value": "Trork_Chest",
            "Description": "The block set designating chests for this NPC"
        },
        "UnderlingGroups": {
            "Value": [
                "Trork_Underlings"
            ],
            "Description": "A list of groups to exclude from reputation sensors"
        }
    },
    "Content": {
        "Instructions": [
            {
                "Enabled": {
                    "Compute": "!StayAtPost"
                },
                "Sensor": {
                    "Type": "Beacon",
                    "Message": "TrorkChieftainCall",
                    "TargetSlot": "LockedTarget"
                },
                "Actions": [
                    {
                        "Type": "ParentState",
                        "State": "Revered"
                    }
                ]
            },
            {
                "$Comment": "This is for handling all the damage/enemy/etc sensors that are common to most states and take priority over everything else",
                "Continue": true,
                "Sensor": {
                    "Type": "Or",
                    "Sensors": [
                        {
                            "Type": "State",
                            "State": ".Patrol"
                        },
                        {
                            "Type": "State",
                            "State": ".SecondaryAnimation"
                        }
                    ]
                },
                "Instructions": [
                    {
                        "Reference": "Component_Trork_Instruction_Pre_Checks",
                        "Modify": {
                            "_ExportStates": [
                                "Alerted",
                                "Chase",
                                "Search",
                                "Warn",
                                "Neutral",
                                "Friendly",
                                "Revered",
                                "Idle"
                            ],
                            "ViewRange": {
                                "Compute": "ViewRange"
                            },
                            "ViewSector": {
                                "Compute": "ViewSector"
                            },
                            "HearingRange": {
                                "Compute": "HearingRange"
                            },
                            "AlertedRange": {
                                "Compute": "AlertedRange"
                            },
                            "ExcludeGroups": {
                                "Compute": "UnderlingGroups"
                            },
                            "ChestBlockSet": {
                                "Compute": "ChestBlockSet"
                            },
                            "ReactToChests": false,
                            "CheckDroppedMeat": false
                        }
                    }
                ]
            },
            {
                "Sensor": {
                    "Type": "State",
                    "State": ".Default"
                },
                "Instructions": [
                    {
                        "Sensor": {
                            "Type": "Any"
                        },
                        "Type": "Random",
                        "Name": "IdleRandom",
                        "Instructions": [
                            {
                                "Weight": 60,
                                "Sensor": {
                                    "Type": "Any"
                                },
                                "Actions": [
                                    {
                                        "Type": "State",
                                        "State": ".Patrol"
                                    }
                                ]
                            },
                            {
                                "Enabled": {
                                    "Compute": "!isEmpty(ExtraIdleComponent)"
                                },
                                "Weight": {
                                    "Compute": "ExtraIdleWeight"
                                },
                                "Sensor": {
                                    "Type": "Any"
                                },
                                "Instructions": [
                                    {
                                        "Reference": {
                                            "Compute": "ExtraIdleComponent"
                                        },
                                        "Interfaces": [
                                            "Hytale.Component.Trork.ExtraIdle"
                                        ],
                                        "Modify": {
                                            "_ExportStates": [
                                                "Idle",
                                                "Alerted",
                                                "Chase",
                                                "Search",
                                                "Warn",
                                                "Neutral",
                                                "Friendly",
                                                "Revered",
                                                "Idle"
                                            ],
                                            "ViewRange": {
                                                "Compute": "ViewRange"
                                            },
                                            "ViewSector": {
                                                "Compute": "ViewSector"
                                            },
                                            "HearingRange": {
                                                "Compute": "HearingRange"
                                            },
                                            "AlertedRange": {
                                                "Compute": "AlertedRange"
                                            },
                                            "RangedAttack": {
                                                "Compute": "RangedAttack"
                                            },
                                            "UnderlingGroups": {
                                                "Compute": "UnderlingGroups"
                                            },
                                            "ChestBlockSet": {
                                                "Compute": "ChestBlockSet"
                                            }
                                        }
                                    }
                                ]
                            },
                            {
                                "Weight": 5,
                                "Sensor": {
                                    "Type": "Any"
                                },
                                "Instructions": [
                                    {
                                        "Sensor": {
                                            "Type": "Any"
                                        },
                                        "Actions": [
                                            {
                                                "Type": "State",
                                                "State": ".Reset"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "Weight": 10,
                                "Sensor": {
                                    "Type": "Any"
                                },
                                "Actions": [
                                    {
                                        "Type": "ParentState",
                                        "State": "Spar"
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                "$Comment": "We use two reset states so that when switching from a secondary behaviour we don't reset the primary random idle. All Instructions with a Once that needs resetting within this state should be mentioned here.",
                "Sensor": {
                    "Type": "State",
                    "State": ".ResetSecondary"
                },
                "Actions": [
                    {
                        "Type": "ResetInstructions",
                        "Instructions": [
                            "IdlePatrol",
                            "IdleSecondary",
                            "IdleSecondaryAnimation"
                        ]
                    },
                    {
                        "Type": "State",
                        "State": ".Default"
                    }
                ]
            },
            {
                "Sensor": {
                    "Type": "State",
                    "State": ".Reset"
                },
                "Actions": [
                    {
                        "Type": "ResetInstructions",
                        "Instructions": [
                            "IdleRandom"
                        ]
                    },
                    {
                        "Type": "State",
                        "State": ".ResetSecondary"
                    }
                ]
            },
            {
                "Sensor": {
                    "Type": "State",
                    "State": ".Patrol"
                },
                "Name": "IdleSecondary",
                "Type": "Random",
                "Instructions": [
                    {
                        "Weight": 20,
                        "Sensor": {
                            "Type": "Any"
                        },
                        "Actions": [
                            {
                                "Type": "State",
                                "State": ".SecondaryAnimation"
                            }
                        ]
                    },
                    {
                        "Weight": 80,
                        "Sensor": {
                            "Type": "Any"
                        },
                        "Name": "IdlePatrol",
                        "Instructions": [
                            {
                                "Reference": "Component_Instruction_Clear_Status_Animation",
                                "Modify": {}
                            },
                            {
                                "Continue": true,
                                "Sensor": {
                                    "Type": "Any"
                                },
                                "Actions": [
                                    {
                                        "Type": "SetLeashPosition",
                                        "ToCurrent": true
                                    },
                                    {
                                        "Type": "Timeout",
                                        "Delay": {
                                            "Compute": "PrimaryIdleTimeout"
                                        },
                                        "Action": {
                                            "Type": "State",
                                            "State": ".Reset"
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                "Sensor": {
                    "Type": "State",
                    "State": ".SecondaryAnimation"
                },
                "Instructions": [
                    {
                        "Sensor": {
                            "Type": "Any"
                        },
                        "$TODO": "Add animations for yawning, swinging weapon, etc",
                        "Name": "IdleSecondaryAnimation",
                        "Instructions": [
                            {
                                "Continue": true,
                                "Sensor": {
                                    "Type": "Any"
                                },
                                "Actions": [
                                    {
                                        "Type": "Timeout",
                                        "Delay": [
                                            2,
                                            4
                                        ],
                                        "Action": {
                                            "Type": "State",
                                            "State": ".ResetSecondary"
                                        }
                                    }
                                ]
                            },
                            {
                                "Sensor": {
                                    "Type": "Any",
                                    "Once": true
                                },
                                "Actions": [
                                    {
                                        "Type": "Random",
                                        "Actions": [
                                            {
                                                "Action": {
                                                    "Type": "PlayAnimation",
                                                    "Slot": "Status",
                                                    "Animation": "IdlePassive"
                                                },
                                                "Weight": 1
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ]
    },
    "Type": "Component"
}